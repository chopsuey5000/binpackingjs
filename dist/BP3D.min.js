!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("BinPacking",[],e):"object"==typeof exports?exports.BinPacking=e():t.BinPacking=e()}(this,(function(){return function(){"use strict";var t={649:function(t,e,i){function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,{Z:function(){return n}})}},e={};function i(n){var h=e[n];if(void 0!==h)return h.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return function(){i.r(n),i.d(n,{Bin:function(){return r},Item:function(){return u},Packer:function(){return p}});var t=i(649);const e=t=>Math.round(t*10**5);let h=!1;function s(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return h?console.debug.apply(console,[t].concat(i)):void 0}const o=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"binpackingjs";return s.bind(void 0,t)}("3D:");class r{constructor(i,n,h,s,o){(0,t.Z)(this,"name",""),(0,t.Z)(this,"width",0),(0,t.Z)(this,"height",0),(0,t.Z)(this,"depth",0),(0,t.Z)(this,"maxWeight",0),(0,t.Z)(this,"items",[]),this.name=i,this.width=e(n),this.height=e(h),this.depth=e(s),this.maxWeight=e(o)}getName(){return this.name}getWidth(){return this.width}getHeight(){return this.height}getDepth(){return this.depth}getMaxWeight(){return this.maxWeight}getItems(){return this.items}getVolume(){return this.getWidth()*this.getHeight()*this.getDepth()}getPackedWeight(){return this.items.reduce(((t,e)=>t+e.getWeight()),0)}weighItem(t){const e=this.getMaxWeight();return!e||t.getWeight()+this.getPackedWeight()<=e}scoreRotation(t,e){t.rotationType=e;let i=t.getDimension();return this.getWidth()<i[0]||this.getHeight()<i[1]||this.getDepth()<i[2]?0:Math.pow(i[0]/this.getWidth(),2)+Math.pow(i[1]/this.getHeight(),2)+Math.pow(i[2]/this.getDepth(),2)}getBestRotationOrder(t){const e={};for(let i=0;i<t.allowedRotation.length;i++){const n=t.allowedRotation[i];e[n]=this.scoreRotation(t,n)}return Object.keys(e).sort(((t,i)=>e[i]-e[t])).map(Number)}putItem(t,e){const i=this;let n=!1;const h=this.getBestRotationOrder(t);t.position=e;for(let s=0;s<h.length;s++){t.rotationType=h[s];let r=t.getDimension();if(i.getWidth()<e[0]+r[0]||i.getHeight()<e[1]+r[1]||i.getDepth()<e[2]+r[2])n=!1;else{n=!0;for(let e=0;e<i.items.length;e++)if(i.items[e].intersect(t)){n=!1;break}n&&i.items.push(t)}if(o("try to putItem",n,"item",t.toString(),"box",i.toString()),n)break}return n}toString(){return"Bin:".concat(this.name," (WxHxD = ").concat(this.getWidth(),"x").concat(this.getHeight(),"x").concat(this.getDepth(),", MaxWg. = ").concat(this.getMaxWeight(),")")}}const g=[0,0,0],a={0:"RotationType_WHD (w,h,d)",1:"RotationType_HWD (h,w,d)",2:"RotationType_HDW (h,d,w)",3:"RotationType_DHW (d,h,w)",4:"RotationType_DWH (d,w,h)",5:"RotationType_WDH (w,d,h)"};class u{constructor(i,n,h,s,o,r){(0,t.Z)(this,"name",""),(0,t.Z)(this,"width",0),(0,t.Z)(this,"height",0),(0,t.Z)(this,"depth",0),(0,t.Z)(this,"weight",0),(0,t.Z)(this,"allowedRotation",[0,1,2,3,4,5]),(0,t.Z)(this,"rotationType",0),(0,t.Z)(this,"position",[]),this.name=i,this.width=e(n),this.height=e(h),this.depth=e(s),this.weight=e(o),this.allowedRotation=r||this.allowedRotation}getWidth(){return this.width}getHeight(){return this.height}getDepth(){return this.depth}getWeight(){return this.weight}getRotationType(){return this.rotationType}getAllowedRotation(){return this.allowedRotation}getRotationTypeString(){return a[this.getRotationType()]}getDimension(){let t;switch(this.rotationType){case 0:t=[this.getWidth(),this.getHeight(),this.getDepth()];break;case 1:t=[this.getHeight(),this.getWidth(),this.getDepth()];break;case 2:t=[this.getHeight(),this.getDepth(),this.getWidth()];break;case 3:t=[this.getDepth(),this.getHeight(),this.getWidth()];break;case 4:t=[this.getDepth(),this.getWidth(),this.getHeight()];break;case 5:t=[this.getWidth(),this.getDepth(),this.getHeight()]}return t}intersect(t){return c(this,t,0,1)&&c(this,t,1,2)&&c(this,t,0,2)}getVolume(){return this.getWidth()*this.getHeight()*this.getDepth()}toString(){return"Item:".concat(this.name," (").concat(this.getRotationTypeString()," = ").concat(this.getDimension().join("x"),", Wg. = ").concat(this.weight,")")}}const c=(t,e,i,n)=>{let h,s,o,r,g,a,u,c;return h=t.getDimension(),s=e.getDimension(),o=t.position[i]+h[i]/2,r=t.position[n]+h[n]/2,g=e.position[i]+s[i]/2,a=e.position[n]+s[n]/2,u=Math.max(o,g)-Math.min(o,g),c=Math.max(r,a)-Math.min(r,a),u<(h[i]+s[i])/2&&c<(h[n]+s[n])/2};class p{constructor(){(0,t.Z)(this,"bins",[]),(0,t.Z)(this,"items",[]),(0,t.Z)(this,"unfitItems",[])}addBin(t){this.bins.push(t)}addItem(t){this.items.push(t)}findFittedBin(t){for(let e=0;e<this.bins.length;e++){let i=this.bins[e];if(i.weighItem(t)&&i.putItem(t,g))return 1===i.items.length&&i.items[0]===t&&(i.items=[]),i}return null}getBiggerBinThan(t){let e=t.getVolume();for(let t=0;t<this.bins;t++){let i=this.bins[t];if(i.getVolume()>e)return i}return null}unfitItem(){0!==this.items.length&&(this.unfitItems.push(this.items[0]),this.items.splice(0,1))}packToBin(t,e){let i=null,n=[];if(!t.weighItem(e[0])||!t.putItem(e[0],g)){let i=this.getBiggerBinThan(t);return i?this.packToBin(i,e):this.items}for(let e=1;e<this.items.length;e++){let h=!1,s=this.items[e];if(t.weighItem(s))t:for(let e=0;e<3;e++)for(let i=0;i<t.items.length;i++){let n,o=t.items[i],r=o.getDimension();switch(e){case 0:n=[o.position[0]+r[0],o.position[1],o.position[2]];break;case 1:n=[o.position[0],o.position[1]+r[1],o.position[2]];break;case 2:n=[o.position[0],o.position[1],o.position[2]+r[2]]}if(t.putItem(s,n)){h=!0;break t}}if(!h){for(;null!==i;)if(i=this.getBiggerBinThan(t),i&&(i.items.push(s),0===this.packToBin(i,i.items).length)){t=i,h=!0;break}h||n.push(s)}}return n}pack(){for(this.bins.sort(((t,e)=>t.getVolume()-e.getVolume())),this.items.sort(((t,e)=>e.getVolume()-t.getVolume()));this.items.length>0;){let t=this.findFittedBin(this.items[0]);null!==t?this.items=this.packToBin(t,this.items):this.unfitItem()}return null}}}(),n}()}));